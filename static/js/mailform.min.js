$(function(){$(document).on("click",'[data-toggle="add-schedule-table"]',function(b){var a=$("#tmpl-new-table").tmpl();a.insertBefore($(this).parent());tinymce.init({selector:".tbody-schedule-detail .content",inline:true,menubar:false,plugins:"link image textcolor colorpicker",toolbar1:"bold link | forecolor backcolor"})});$(document).on("click",'[data-toggle="remove-schedule-table"]',function(a){if(!confirm("해당 일차를 삭제하시겠습니까?")){return false}$(this).parent().parent().parent().parent().prev().remove();$(this).parent().parent().parent().parent().remove()});$(document).on("click","a.editable",function(c){c.preventDefault();var b=$(this);var a=prompt("변경할 텍스트를 입력하세요",b.text());if(a){b.text(a)}});$(document).on("click",'[data-toggle="prepend-schedule-row"]',function(a){a.preventDefault();var b=$("#tmpl-new-row").tmpl();b.insertBefore($(this).parent().parent().parent());tinymce.init({selector:".tbody-schedule-detail .content",inline:true,menubar:false,plugins:"link image textcolor colorpicker",toolbar1:"bold link | forecolor backcolor"})});$(document).on("click",'[data-toggle="append-schedule-row"]',function(a){a.preventDefault();var b=$("#tmpl-new-row").tmpl();b.insertAfter($(this).parent().parent().parent());tinymce.init({selector:".tbody-schedule-detail .content",inline:true,menubar:false,plugins:"link image textcolor colorpicker",toolbar1:"bold link | forecolor backcolor"})});$(document).on("click",'[data-toggle="remove-schedule-row"]',function(a){a.preventDefault();if(!confirm("해당 행을 삭제하시겠습니까?")){return false}$(this).parent().parent().parent().remove()});tinymce.init({selector:".tbody-schedule-detail .content",inline:true,menubar:false,plugins:"link image textcolor colorpicker",toolbar1:"bold link | forecolor backcolor"});$(".tinymce").each(function(){var a=$(this).attr("id");if(!a||$(this).prop("nodeName")!="TEXTAREA"){return true}tinymce.init({selector:"textarea#"+a,height:300,width:"618px",theme_advanced_resizing:true,theme_advanced_resizing_use_cookie:false,menubar:false,plugins:"advlist autolink link image imagetools media lists print preview emoticons table textcolor colorpicker code pagebreak jsplus_easy_image",language:"ko",toolbar1:"jsplus_easy_image image media table | alignleft aligncenter alignright alignjustify | bullist numlist | outdent indent blockquote | link pagebreak",toolbar2:"formatselect fontselect fontsizeselect | forecolor backcolor | bold italic underline strikethrough removeformat",font_formats:"나눔고딕=Nanum Gothic;돋움=돋움,Dotum;굴림=굴림,Gulim;바탕=바탕,Batang;궁서=궁서;Arial=Arial;Comic Sans MS=Comic Sans MS;Courier New=Courier New;Tahoma=Tahoma;Times New Roman=Times New Roman;Verdana=Verdana",fontsize_formats:"10px 11px 12px 14px 16px 18px 20px 24px 28px"})});$("input[type='file']").on("change",function(){if(!$(this).val()){return}if(!confirm("선택한 파일을 첨부하시겠습니까?")){return false}var a=new FormData();a.append("userfile",$(this)[0].files[0]);$.ajax({url:"/api/products/attach",type:"POST",processData:false,contentType:false,data:a,fail:function(){alert("파일 업로드에 실패하였습니다.")},success:function(f){if(f.status==true){var c=$("<li>");var e=$("<input>").attr({type:"hidden",name:"attach_list[]",value:f.result.full_path});var b=$("<input>").attr({type:"hidden",name:"attach_name[]",value:f.result.orig_name});var d=$("<a>").attr({href:"javascript:;","data-toggle":"remove-attach","data-value":f.result.full_path}).addClass("text-color-red").html("&times;");c.text(f.result.orig_name).append(b).append(e).append(d);$(".attach-list").append(c);$("a[data-toggle='remove-attach']").off("click.remove_attach").on("click.remove_attach",function(){var g=$(this).data("value");var h=$(this);$.ajax({url:"/api/products/attach",type:"DELETE",beforeSend:function(i){i.setRequestHeader("Content-Type","application/json")},data:{path:g},success:function(){h.parent().remove()}})})}else{alert("파일 업로드 도중 오류가 발생하였습니다.\n"+f.result)}}})});$("[data-toggle='add-attach']").on("click",function(){$("input[type='file']").click()})});function get_data(){var a=[];$(".table-schedules").each(function(){var c=$(this).find(".days-info>.editable").text();var g=$(this).find(".days-meal-b>.editable").text();var b=$(this).find(".days-meal-l>.editable").text();var f=$(this).find(".days-meal-d>.editable").text();g=g=="없음"?"":g;b=b=="없음"?"":b;f=f=="없음"?"":f;var e=[];$(this).find(".tbody-schedule-detail > tr").each(function(){e.push($(this).find("td > div.content").html())});var d={day:c,meal:{b:g,l:b,d:f},content:e};a.push(d)});$("textarea[name='content']").val(JSON.stringify(a))};